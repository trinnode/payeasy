/**
 * Environment variables for data retention and cleanup operations
 * Configure these in your .env.local or deployment platform
 */

// ============================================================================
// Supabase Configuration (required)
// ============================================================================

// Supabase project URL
// Example: https://xxxxxxxxxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url

// Supabase Anon Key (public, safe to expose)
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key

// Supabase Service Role Key (private, must be kept secret)
// Used for cleanup operations that require elevated privileges
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

// ============================================================================
// Job Scheduling Configuration
// ============================================================================

// Enable/disable cleanup jobs
CLEANUP_ENABLED=true

// Cron secret for verifying scheduled job requests (Vercel Crons)
// Generate with: `openssl rand -hex 32`
CRON_SECRET=your_secret_token

// Timezone for cron schedules (optional, defaults to UTC)
CLEANUP_TIMEZONE=UTC

// ============================================================================
// Cleanup Policy Configuration
// ============================================================================

// Audit logs retention in days
AUDIT_LOG_RETENTION_DAYS=365

// Soft-deleted records retention in days (recovery window)
SOFT_DELETE_RETENTION_DAYS=90

// Expired sessions retention in days
SESSION_RETENTION_DAYS=7

// Inactive conversation retention in days
CONVERSATION_RETENTION_DAYS=180

// Deleted user anonymization delay in days
ANONYMIZATION_DELAY_DAYS=30

// Backup retention in days
BACKUP_RETENTION_DAYS=30

// ============================================================================
// Performance Configuration
// ============================================================================

// Batch size for cleanup operations
CLEANUP_BATCH_SIZE=1000

// Delay between batch operations in milliseconds
CLEANUP_BATCH_DELAY_MS=100

// Maximum concurrent cleanup jobs
MAX_CONCURRENT_CLEANUP_JOBS=1

// Job timeout in milliseconds
CLEANUP_JOB_TIMEOUT_MS=300000

// ============================================================================
// Failure Handling & Monitoring
// ============================================================================

// Maximum retry attempts for failed jobs
CLEANUP_MAX_RETRIES=3

// Webhook URL for failure alerts (optional)
// Supports Slack, Discord, or custom webhooks
ALERT_WEBHOOK_URL=https://hooks.yourservice.com/cleanup-alerts

// Email address for failure notifications (optional)
CLEANUP_ALERT_EMAIL=admin@payeasy.app

// ============================================================================
// Feature Flags
// ============================================================================

// Enable audit log cleanup
ENABLE_AUDIT_LOG_CLEANUP=true

// Enable soft-delete cleanup
ENABLE_SOFT_DELETE_CLEANUP=true

// Enable session cleanup
ENABLE_SESSION_CLEANUP=true

// Enable conversation archival
ENABLE_CONVERSATION_ARCHIVAL=true

// Enable user anonymization
ENABLE_USER_ANONYMIZATION=true

// Enable backup cleanup
ENABLE_BACKUP_CLEANUP=true

// Enable failure alerts
ENABLE_CLEANUP_ALERTS=true

// Enable detailed logging (not recommended for production)
CLEANUP_DEBUG_LOGGING=false

// ============================================================================
// Database Configuration (Optional)
// ============================================================================

// If using separate session storage table
SUPABASE_USE_SESSION_TABLE=false

// Database connection pool size (optional)
DATABASE_POOL_SIZE=10

// Database query timeout in milliseconds (optional)
DATABASE_QUERY_TIMEOUT=30000

// ============================================================================
// Anonymization Configuration
// ============================================================================

// Preserve audit trail when anonymizing users
ANONYMIZATION_PRESERVE_AUDIT=true

// Hash email addresses during anonymization
ANONYMIZATION_HASH_EMAIL=true

// Anonymize usernames
ANONYMIZATION_HASH_USERNAME=true

// Remove user bio data
ANONYMIZATION_REMOVE_BIO=true

// ============================================================================
// Backup Configuration
// ============================================================================

// Backup storage location (Supabase bucket name)
BACKUP_STORAGE_LOCATION=backups

// Enable backup compression
BACKUP_COMPRESSION_ENABLED=true

// Enable backup encryption
BACKUP_ENCRYPTION_ENABLED=true

// Backup encryption algorithm
BACKUP_ENCRYPTION_ALGORITHM=aes-256-cbc

// ============================================================================
// Logging & Monitoring
// ============================================================================

// Log level for cleanup operations
CLEANUP_LOG_LEVEL=info

// Enable structured logging for easier monitoring
STRUCTURED_LOGGING_ENABLED=true

// External logging service integration (optional)
// Supports: datadog, newrelic, sentry, custom
LOGGING_SERVICE=sentry
LOGGING_SERVICE_KEY=your_logging_key

// ============================================================================
// Development/Testing Configuration
// ============================================================================

// Skip cleanup in development
SKIP_CLEANUP_IN_DEV=false

// Dry-run mode (logs what would happen without making changes)
CLEANUP_DRY_RUN=false

// Mock external services (for testing)
MOCK_EXTERNAL_SERVICES=false

// ============================================================================
// Compliance Configuration
// ============================================================================

// Enable GDPR compliance features
GDPR_COMPLIANCE_MODE=true

// Retain audit logs for compliance (minimum days)
COMPLIANCE_AUDIT_RETENTION_MIN_DAYS=365

// Enable PII removal for deleted users
COMPLIANCE_REMOVE_PII=true

// ============================================================================
// Example Configuration for Different Environments
// ============================================================================

# Development (.env.local)
# ============================================================================
# NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
# SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
# CLEANUP_ENABLED=false
# CLEANUP_DRY_RUN=true
# CLEANUP_DEBUG_LOGGING=true

# Staging (.env.staging)
# ============================================================================
# NEXT_PUBLIC_SUPABASE_URL=https://staging-xxx.supabase.co
# SUPABASE_SERVICE_ROLE_KEY=eyJ...
# CLEANUP_ENABLED=true
# CLEANUP_DEBUG_LOGGING=true
# CLEANUP_MAX_RETRIES=3
# LOGGING_SERVICE=datadog

# Production (.env.production)
# ============================================================================
# NEXT_PUBLIC_SUPABASE_URL=https://prod-xxx.supabase.co
# SUPABASE_SERVICE_ROLE_KEY=eyJ...
# CLEANUP_ENABLED=true
# CLEANUP_DEBUG_LOGGING=false
# CLEANUP_MAX_RETRIES=5
# LOGGING_SERVICE=sentry
# ALERT_WEBHOOK_URL=https://slack.webhook.com/...
# GDPR_COMPLIANCE_MODE=true

// ============================================================================
// Notes & Best Practices
// ============================================================================

/*
1. SECURITY:
   - Keep SUPABASE_SERVICE_ROLE_KEY secret
   - Rotation recommended every 90 days
   - Use strong CRON_SECRET (32+ characters)
   - Restrict access to cleanup API endpoints

2. PERFORMANCE:
   - Adjust CLEANUP_BATCH_SIZE based on your data volume
   - Increase batch delay if database is under heavy load
   - Consider running cleanups during off-peak hours

3. COMPLIANCE:
   - Keep COMPLIANCE_AUDIT_RETENTION_MIN_DAYS at 365 or higher
   - Enable GDPR_COMPLIANCE_MODE for EU deployments
   - Document all cleanup operations for compliance

4. MONITORING:
   - Set up webhook alerts for cleanup failures
   - Monitor cleanup job execution history
   - Review statistics weekly
   - Set up performance alerts

5. TESTING:
   - Use CLEANUP_DRY_RUN=true before production deployment
   - Test with real data in staging environment
   - Verify backups before cleanup operations
   - Test failure scenarios and recovery

6. MAINTENANCE:
   - Review retention policies quarterly
   - Adjust based on your data growth patterns
   - Monitor storage usage after cleanup
   - Update schedules as needed
*/
